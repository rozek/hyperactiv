{"version":3,"file":"index.mjs","sources":["../../src/react/context/index.js","../../src/react/hooks/context.js","../../src/react/watchHoc.js","../../src/react/watchComponent.js","../../src/react/hooks/dependencies.js","../../src/http/tools.js","../../src/react/hooks/useNormalizedRequest.js","../../src/react/hooks/useRequest.js","../../src/react/hooks/useResource.js","../../src/react/hooks/index.js","../../src/react/index.js"],"sourcesContent":["import React from 'react'\nimport ReactDOMServer from 'react-dom/server'\n\nexport const HyperactivContext = React.createContext({\n  store: null,\n  client: null\n})\n\nexport const SSRContext = React.createContext(null)\n\nexport function HyperactivProvider({ children, store, client }) {\n  return React.createElement(\n    HyperactivContext.Provider,\n    {\n      value: { store, client }\n    },\n    children\n  )\n}\n\nexport function SSRProvider({ children, promises }) {\n  return React.createElement(\n    SSRContext.Provider,\n    {\n      value: promises\n    },\n    children\n  )\n}\n\nexport async function preloadData(jsx, { depth = null } = {}) {\n  let loopIterations = 0\n  const promises = []\n  while(loopIterations === 0 || promises.length > 0) {\n    if(depth !== null && loopIterations >= depth)\n      break\n    promises.length = 0\n    ReactDOMServer.renderToStaticMarkup(\n      React.createElement(\n        SSRProvider,\n        { promises },\n        jsx\n      )\n    )\n    await Promise.all(promises)\n    loopIterations++\n  }\n}\n","import { useContext } from 'react'\nimport { HyperactivContext } from '../context/index.js'\n\nexport function useStore() {\n  const context = useContext(HyperactivContext)\n  return context && context.store\n}\n\nexport function useClient() {\n  const context = useContext(HyperactivContext)\n  return context && context.client\n}\n","import React from 'react'\nimport hyperactiv from '../../src/index.js'\nimport { useStore } from './hooks/context.js'\nconst { computed, dispose } = hyperactiv\n\n/**\n * Wraps a class component and automatically updates it when the store mutates.\n * @param {*} Component The component to wrap\n */\nconst watchClassComponent = Component => new Proxy(Component, {\n  construct: function(Target, argumentsList) {\n    // Create a new Component instance\n    const instance = new Target(...argumentsList)\n    // Ensures that the forceUpdate in correctly bound\n    instance.forceUpdate = instance.forceUpdate.bind(instance)\n    // Monkey patch the componentWillUnmount method to do some clean up on destruction\n    const originalUnmount =\n      typeof instance.componentWillUnmount === 'function' &&\n      instance.componentWillUnmount.bind(instance)\n    instance.componentWillUnmount = function(...args) {\n      dispose(instance.forceUpdate)\n      if(originalUnmount) {\n        originalUnmount(...args)\n      }\n    }\n    // Return a proxified Component\n    return new Proxy(instance, {\n      get: function(target, property) {\n        if(property === 'render') {\n          // Compute the render function and forceUpdate on changes\n          return computed(target.render.bind(target), { autoRun: false, callback: instance.forceUpdate })\n        }\n        return target[property]\n      }\n    })\n  }\n})\n\n/**\n * Wraps a functional component and automatically updates it when the store mutates.\n * @param {*} component The component to wrap\n */\nfunction watchFunctionalComponent(component) {\n  const wrapper = props => {\n    const [, forceUpdate] = React.useReducer(x => x + 1, 0)\n    const store = useStore()\n    const injectedProps = props.store ? props : {\n      ...props,\n      store\n    }\n    const [child, setChild] = React.useState(null)\n    React.useEffect(function onMount() {\n      const callback = () => forceUpdate()\n      setChild(() => computed(component, {\n        autoRun: false,\n        callback\n      }))\n      return function onUnmount() {\n        dispose(callback)\n      }\n    }, [])\n    return child ? child(injectedProps) : component(injectedProps)\n  }\n  wrapper.displayName = component.displayName || component.name\n  return wrapper\n}\n\n/**\n * Wraps a component and automatically updates it when the store mutates.\n * @param {*} Component The component to wrap\n */\nexport const watch = Component =>\n  typeof Component === 'function' &&\n    (!Component.prototype || !Component.prototype.isReactComponent) ?\n    watchFunctionalComponent(Component) :\n    watchClassComponent(Component)\n","import React from 'react'\nimport hyperactiv from '../../src/index.js'\nconst { computed, dispose } = hyperactiv\n\nexport class Watch extends React.Component {\n  constructor(props) {\n    super(props)\n    this._callback = () => {\n      this._mounted &&\n            this.forceUpdate.bind(this)()\n    }\n    this.computeRenderMethod(props.render)\n  }\n  componentWillUnmount() {\n    this._mounted = false\n    dispose(this._callback)\n  }\n  componentDidMount() {\n    this._mounted = true\n  }\n  computeRenderMethod(newRender) {\n    if(!!newRender && this._currentRender !== newRender) {\n      this._currentRender = computed(newRender, {\n        autoRun: false,\n        callback: this._callback\n      })\n    }\n  }\n  render() {\n    const { render } = this.props\n    this.computeRenderMethod(render)\n    return this._currentRender && this._currentRender() || null\n  }\n}\n","export default new Proxy({\n  references: {\n    wretch: null,\n    normaliz: null\n  }\n}, {\n  get(target, property) {\n    if(target[property])\n      return target[property]\n    throw 'Hook dependencies are not registered!\\nUse `.setHooksDependencies({ wretch, normaliz }) to set them.'\n  }\n})","export const defaultRootKey = '__requests__'\nexport const defaultSerialize = (method, url) => `${method}@${url}`\nexport const identity = _ => _\n\nexport const normalizedOperations = {\n  read(mappings, store) {\n    const storeFragment = {}\n    Object.entries(mappings).forEach(([ entity, ids ]) => {\n      storeFragment[entity] = {}\n      ids.forEach(key => {\n        storeFragment[entity][key] = store[entity] && store[entity][key] || null\n      })\n    })\n    return storeFragment\n  },\n  write(normalizedData, store) {\n    Object.entries(normalizedData).forEach(([ entity, entityData ]) => {\n      if(!store[entity]) {\n        store[entity] = {}\n      }\n\n      Object.entries(entityData).forEach(([ key, value ]) => {\n        if(store[entity][key]) {\n          if(typeof store[entity][key] === 'object' && typeof value === 'object') {\n            Object.entries(value).forEach(([k, v]) => {\n              store[entity][key][k] = v\n            })\n          } else {\n            store[entity][key] = value\n          }\n        } else {\n          store[entity][key] = value\n        }\n      })\n    })\n  }\n}\n","import { useState, useMemo, useEffect, useContext, useRef } from 'react'\n\nimport { identity, defaultSerialize, defaultRootKey, normalizedOperations } from '../../http/tools.js'\nimport { HyperactivContext, SSRContext } from '../context/index.js'\nimport dependencies from './dependencies.js'\n\nexport function useNormalizedRequest(url, {\n  store,\n  normalize,\n  client,\n  skip = () => false,\n  beforeRequest = identity,\n  afterRequest = identity,\n  rootKey = defaultRootKey,\n  serialize = defaultSerialize,\n  bodyType = 'json',\n  policy = 'cache-first',\n  ssr = true\n}) {\n  const contextValue = useContext(HyperactivContext)\n  const ssrContext = ssr && useContext(SSRContext)\n  store = contextValue && contextValue.store || store\n  client = contextValue && contextValue.client || client || dependencies.references.wretch()\n\n  const configuredClient = useMemo(() => beforeRequest(client.url(url)), [client, beforeRequest, url])\n  const storeKey = useMemo(() => serialize('get', configuredClient._url), [configuredClient])\n  if(!store[rootKey]) {\n    store[rootKey] = {}\n  }\n  const storedMappings = store[rootKey][storeKey]\n\n  const cacheLookup = policy !== 'network-only'\n\n  const [ error, setError ] = useState(null)\n  const [ loading, setLoading ] = useState(\n    !cacheLookup ||\n        !storedMappings\n  )\n  const [ networkData, setNetworkData ] = useState(null)\n  const data =\n        cacheLookup ?\n          storedMappings &&\n            normalizedOperations.read(storedMappings, store) :\n          networkData\n\n  const unmounted = useRef(false)\n  useEffect(() => () => unmounted.current = false, [])\n  const pendingRequests = useRef([])\n\n  function refetch(noState) {\n    if(!noState && !unmounted.current) {\n      setLoading(true)\n      setError(null)\n      setNetworkData(null)\n    }\n    const promise = configuredClient\n      .get()\n    // eslint-disable-next-line no-unexpected-multiline\n      [bodyType](body => afterRequest(body))\n      .then(result => {\n        const normalizedData = dependencies.references.normaliz(result, normalize)\n        store[rootKey][storeKey] = Object.entries(normalizedData).reduce((mappings, [ entity, dataById ]) => {\n          mappings[entity] = Object.keys(dataById)\n          return mappings\n        }, {})\n        normalizedOperations.write(normalizedData, store)\n        const storeSlice = normalizedOperations.read(store[rootKey][storeKey], store)\n        pendingRequests.current.splice(pendingRequests.current.indexOf(promise), 1)\n        if(!ssrContext && !unmounted.current && pendingRequests.current.length === 0) {\n          setNetworkData(storeSlice)\n          setLoading(false)\n        }\n        return storeSlice\n      })\n      .catch(error => {\n        pendingRequests.current.splice(pendingRequests.current.indexOf(promise), 1)\n        if(!ssrContext && !unmounted.current && pendingRequests.current.length === 0) {\n          setError(error)\n          setLoading(false)\n        }\n        if(ssrContext)\n          throw error\n      })\n\n    pendingRequests.current.push(promise)\n    if(ssrContext) {\n      ssrContext.push(promise)\n    }\n    return promise\n  }\n\n  function checkAndRefetch(noState = false) {\n    if(\n      !skip() &&\n            !error &&\n            (policy !== 'cache-first' || !data)\n    ) {\n      refetch(noState)\n    }\n  }\n\n  useEffect(function() {\n    checkAndRefetch()\n  }, [ storeKey, skip() ])\n\n  if(ssrContext) {\n    checkAndRefetch(true)\n  }\n\n  return skip() ? {\n    data: null,\n    error: null,\n    loading: false,\n    refetch\n  } : {\n    loading,\n    data,\n    error,\n    refetch\n  }\n}\n","import { useState, useMemo, useEffect, useContext, useRef } from 'react'\nimport { identity, defaultSerialize, defaultRootKey } from '../../http/tools.js'\nimport { HyperactivContext, SSRContext } from '../context/index.js'\nimport dependencies from './dependencies.js'\n\nexport function useRequest(url, {\n  store,\n  client,\n  skip = () => false,\n  beforeRequest = identity,\n  afterRequest = identity,\n  rootKey = defaultRootKey,\n  serialize = defaultSerialize,\n  bodyType = 'json',\n  policy = 'cache-first',\n  ssr = true\n}) {\n  const contextValue = useContext(HyperactivContext)\n  const ssrContext = ssr && useContext(SSRContext)\n  store = contextValue && contextValue.store || store\n  client = contextValue && contextValue.client || client || dependencies.references.wretch()\n\n  const configuredClient = useMemo(() => beforeRequest(client.url(url)), [client, beforeRequest, url])\n  const storeKey = useMemo(() => serialize('get', configuredClient._url), [configuredClient])\n  if(!store[rootKey]) {\n    store[rootKey] = {}\n  }\n  const storedData = store[rootKey][storeKey]\n\n  const cacheLookup = policy !== 'network-only'\n\n  const [ error, setError ] = useState(null)\n  const [ loading, setLoading ] = useState(\n    !cacheLookup ||\n        !storedData\n  )\n  const [ networkData, setNetworkData ] = useState(null)\n  const data = cacheLookup ? storedData : networkData\n\n  const unmounted = useRef(false)\n  useEffect(() => () => unmounted.current = false, [])\n  const pendingRequests = useRef([])\n\n  function refetch(noState) {\n    if(!noState && !unmounted.current) {\n      setLoading(true)\n      setError(null)\n      setNetworkData(null)\n    }\n    const promise = configuredClient\n      .get()\n    // eslint-disable-next-line no-unexpected-multiline\n      [bodyType](body => afterRequest(body))\n      .then(result => {\n        store[rootKey][storeKey] = result\n        pendingRequests.current.splice(pendingRequests.current.indexOf(promise), 1)\n        if(!ssrContext && !unmounted.current && pendingRequests.current.length === 0) {\n          setNetworkData(result)\n          setLoading(false)\n        }\n        return result\n      })\n      .catch(error => {\n        pendingRequests.current.splice(pendingRequests.current.indexOf(promise), 1)\n        if(!ssrContext && !unmounted.current && pendingRequests.current.length === 0) {\n          setError(error)\n          setLoading(false)\n        }\n        if(ssrContext)\n          throw error\n      })\n\n    pendingRequests.current.push(promise)\n    if(ssrContext) {\n      ssrContext.push(promise)\n    }\n    return promise\n  }\n\n  function checkAndRefetch(noState = false) {\n    if(\n      !skip() &&\n            !error &&\n            (policy !== 'cache-first' || !data)\n    ) {\n      refetch(noState)\n    }\n  }\n\n  useEffect(function() {\n    checkAndRefetch()\n  }, [ storeKey, skip() ])\n\n  if(ssrContext) {\n    checkAndRefetch(true)\n  }\n\n  return skip() ? {\n    data: null,\n    error: null,\n    loading: false,\n    refetch\n  } : {\n    loading,\n    data,\n    error,\n    refetch\n  }\n}\n","import { useMemo, useContext } from 'react'\nimport { useNormalizedRequest } from './useNormalizedRequest.js'\nimport { HyperactivContext } from '../context/index.js'\n\nfunction formatData(data, entity, id) {\n  return (\n    data ?\n      id !== null ?\n        data[entity] && data[entity][id] :\n        data[entity] && Object.values(data[entity]) :\n      data\n  )\n}\n\nexport function useResource(entity, url, {\n  id = null,\n  store,\n  normalize,\n  client,\n  skip: skipProp = () => false,\n  beforeRequest,\n  afterRequest,\n  serialize,\n  rootKey,\n  bodyType,\n  policy = 'cache-first',\n  ssr = true\n}) {\n  const contextValue = useContext(HyperactivContext)\n  store = contextValue && contextValue.store || store\n  const storedEntity = id && store[entity] && store[entity][id]\n\n  const {\n    data,\n    loading,\n    error,\n    refetch: normalizedRefetch\n  } = useNormalizedRequest(url, {\n    store,\n    normalize: {\n      schema: [],\n      ...normalize,\n      entity\n    },\n    client,\n    skip() {\n      return (\n        policy === 'cache-first' && storedEntity ||\n                skipProp()\n      )\n    },\n    beforeRequest,\n    afterRequest,\n    serialize,\n    rootKey,\n    bodyType,\n    policy,\n    ssr\n  })\n\n  const formattedData = useMemo(() =>\n    formatData(data, entity, id)\n  , [data, entity, id])\n\n  const refetch = () => normalizedRefetch().then(data =>\n    formatData(data, entity, id)\n  )\n\n  if(policy !== 'network-only' && storedEntity) {\n    return {\n      data: storedEntity,\n      loading: false,\n      error: null,\n      refetch\n    }\n  }\n\n  return {\n    data: formattedData,\n    loading,\n    error,\n    refetch\n  }\n}\n","import dependencies from './dependencies.js'\n\nexport function setHooksDependencies({ wretch, normaliz }) {\n  if(wretch) dependencies.references.wretch = wretch\n  if(normaliz) dependencies.references.normaliz = normaliz\n}\n\nexport * from './useNormalizedRequest.js'\nexport * from './useRequest.js'\nexport * from './useResource.js'\nexport * from './context.js'\n","import hyperactiv from '../../src/index.js'\n\nexport { watch } from './watchHoc.js'\nexport { Watch } from './watchComponent.js'\nexport * from './hooks/index.js'\nexport * from './context/index.js'\n\nexport const store = function(obj, options = {}) {\n  return hyperactiv.observe(obj, Object.assign({ deep: true, batch: false }, options))\n}\n"],"names":["HyperactivContext","React","createContext","store","client","SSRContext","HyperactivProvider","children","createElement","Provider","value","SSRProvider","promises","async","preloadData","jsx","depth","loopIterations","length","ReactDOMServer","renderToStaticMarkup","Promise","all","useStore","context","useContext","useClient","computed","dispose","hyperactiv","watch","Component","prototype","isReactComponent","Proxy","construct","Target","argumentsList","instance","forceUpdate","bind","originalUnmount","componentWillUnmount","args","get","target","property","render","autoRun","callback","watchClassComponent","component","wrapper","props","useReducer","x","injectedProps","child","setChild","useState","useEffect","displayName","name","watchFunctionalComponent","Watch","constructor","super","this","_callback","_mounted","computeRenderMethod","componentDidMount","newRender","_currentRender","dependencies","references","wretch","normaliz","defaultRootKey","defaultSerialize","method","url","identity","_","normalizedOperations","read","mappings","storeFragment","Object","entries","forEach","entity","ids","key","write","normalizedData","entityData","k","v","useNormalizedRequest","normalize","skip","beforeRequest","afterRequest","rootKey","serialize","bodyType","policy","ssr","contextValue","ssrContext","configuredClient","useMemo","storeKey","_url","storedMappings","cacheLookup","error","setError","loading","setLoading","networkData","setNetworkData","data","unmounted","useRef","current","pendingRequests","refetch","noState","promise","body","then","result","reduce","dataById","keys","storeSlice","splice","indexOf","catch","push","checkAndRefetch","useRequest","storedData","formatData","id","values","useResource","skipProp","storedEntity","normalizedRefetch","schema","formattedData","setHooksDependencies","obj","options","observe","assign","deep","batch"],"mappings":"wJAGY,MAACA,EAAoBC,EAAMC,cAAc,CACnDC,MAAO,KACPC,OAAQ,OAGGC,EAAaJ,EAAMC,cAAc,MAEvC,SAASI,GAAmBC,SAAEA,EAAQJ,MAAEA,EAAKC,OAAEA,IACpD,OAAOH,EAAMO,cACXR,EAAkBS,SAClB,CACEC,MAAO,CAAEP,QAAOC,WAElBG,EAEJ,CAEO,SAASI,GAAYJ,SAAEA,EAAQK,SAAEA,IACtC,OAAOX,EAAMO,cACXH,EAAWI,SACX,CACEC,MAAOE,GAETL,EAEJ,CAEOM,eAAeC,EAAYC,GAAKC,MAAEA,EAAQ,MAAS,CAAA,GACxD,IAAIC,EAAiB,EACrB,MAAML,EAAW,GACjB,MAAyB,IAAnBK,GAAwBL,EAASM,OAAS,MACjC,OAAVF,GAAkBC,GAAkBD,IAEvCJ,EAASM,OAAS,EAClBC,EAAeC,qBACbnB,EAAMO,cACJG,EACA,CAAEC,YACFG,UAGEM,QAAQC,IAAIV,GAClBK,GAEJ,CC5CO,SAASM,IACd,MAAMC,EAAUC,EAAWzB,GAC3B,OAAOwB,GAAWA,EAAQrB,KAC5B,CAEO,SAASuB,IACd,MAAMF,EAAUC,EAAWzB,GAC3B,OAAOwB,GAAWA,EAAQpB,MAC5B,CCRA,eAAQuB,EAAQC,QAAEA,GAAYC,EAoElB,MAACC,EAAQC,GACE,mBAAdA,GACHA,EAAUC,WAAcD,EAAUC,UAAUC,iBAhEtBF,IAAa,IAAIG,MAAMH,EAAW,CAC5DI,UAAW,SAASC,EAAQC,GAE1B,MAAMC,EAAW,IAAIF,KAAUC,GAE/BC,EAASC,YAAcD,EAASC,YAAYC,KAAKF,GAEjD,MAAMG,EACqC,mBAAlCH,EAASI,sBAChBJ,EAASI,qBAAqBF,KAAKF,GAQrC,OAPAA,EAASI,qBAAuB,YAAYC,GAC1Cf,EAAQU,EAASC,aACdE,GACDA,KAAmBE,EAEtB,EAEM,IAAIT,MAAMI,EAAU,CACzBM,IAAK,SAASC,EAAQC,GACpB,MAAgB,WAAbA,EAEMnB,EAASkB,EAAOE,OAAOP,KAAKK,GAAS,CAAEG,SAAS,EAAOC,SAAUX,EAASC,cAE5EM,EAAOC,EACf,GAEJ,IAwCCI,CAAoBnB,GAjCxB,SAAkCoB,GAChC,MAAMC,EAAUC,IACd,MAAS,CAAAd,GAAetC,EAAMqD,YAAWC,GAAKA,EAAI,GAAG,GAC/CpD,EAAQoB,IACRiC,EAAgBH,EAAMlD,MAAQkD,EAAQ,IACvCA,EACHlD,UAEKsD,EAAOC,GAAYzD,EAAM0D,SAAS,MAWzC,OAVA1D,EAAM2D,WAAU,WACd,MAAMX,EAAW,IAAMV,IAKvB,OAJAmB,GAAS,IAAM/B,EAASwB,EAAW,CACjCH,SAAS,EACTC,eAEK,WACLrB,EAAQqB,EACT,CACF,GAAE,IACIQ,EAAQA,EAAMD,GAAiBL,EAAUK,EAAa,EAG/D,OADAJ,EAAQS,YAAcV,EAAUU,aAAeV,EAAUW,KAClDV,CACT,CASIW,CAAyBhC,ICxEvBJ,SAAEA,EAAQC,QAAEA,GAAYC,EAEvB,MAAMmC,UAAc/D,EAAM8B,UAC/B,WAAAkC,CAAYZ,GACVa,MAAMb,GACNc,KAAKC,UAAY,KACfD,KAAKE,UACCF,KAAK5B,YAAYC,KAAK2B,KAAtBA,EAA6B,EAErCA,KAAKG,oBAAoBjB,EAAMN,OAChC,CACD,oBAAAL,GACEyB,KAAKE,UAAW,EAChBzC,EAAQuC,KAAKC,UACd,CACD,iBAAAG,GACEJ,KAAKE,UAAW,CACjB,CACD,mBAAAC,CAAoBE,GACbA,GAAaL,KAAKM,iBAAmBD,IACxCL,KAAKM,eAAiB9C,EAAS6C,EAAW,CACxCxB,SAAS,EACTC,SAAUkB,KAAKC,YAGpB,CACD,MAAArB,GACE,MAAMA,OAAEA,GAAWoB,KAAKd,MAExB,OADAc,KAAKG,oBAAoBvB,GAClBoB,KAAKM,gBAAkBN,KAAKM,kBAAoB,IACxD,EChCH,IAAeC,EAAA,IAAIxC,MAAM,CACvByC,WAAY,CACVC,OAAQ,KACRC,SAAU,OAEX,CACD,GAAAjC,CAAIC,EAAQC,GACV,GAAGD,EAAOC,GACR,OAAOD,EAAOC,GAChB,KAAM,sGACP,ICVI,MAAMgC,EAAiB,eACjBC,EAAmB,CAACC,EAAQC,IAAQ,GAAGD,KAAUC,IACjDC,EAAWC,GAAKA,EAEhBC,EAAuB,CAClC,IAAAC,CAAKC,EAAUnF,GACb,MAAMoF,EAAgB,CAAE,EAOxB,OANAC,OAAOC,QAAQH,GAAUI,SAAQ,EAAGC,EAAQC,MAC1CL,EAAcI,GAAU,CAAE,EAC1BC,EAAIF,SAAQG,IACVN,EAAcI,GAAQE,GAAO1F,EAAMwF,IAAWxF,EAAMwF,GAAQE,IAAQ,IAAI,GACxE,IAEGN,CACR,EACD,KAAAO,CAAMC,EAAgB5F,GACpBqF,OAAOC,QAAQM,GAAgBL,SAAQ,EAAGC,EAAQK,MAC5C7F,EAAMwF,KACRxF,EAAMwF,GAAU,CAAE,GAGpBH,OAAOC,QAAQO,GAAYN,SAAQ,EAAGG,EAAKnF,MACtCP,EAAMwF,GAAQE,IACkB,iBAAvB1F,EAAMwF,GAAQE,IAAsC,iBAAVnF,EAClD8E,OAAOC,QAAQ/E,GAAOgF,SAAQ,EAAEO,EAAGC,MACjC/F,EAAMwF,GAAQE,GAAKI,GAAKC,CAAC,IAM7B/F,EAAMwF,GAAQE,GAAOnF,CACtB,GACD,GAEL,GC7BI,SAASyF,EAAqBlB,GAAK9E,MACxCA,EAAKiG,UACLA,EAAShG,OACTA,EAAMiG,KACNA,EAAO,MAAM,GAAKC,cAClBA,EAAgBpB,EAAQqB,aACxBA,EAAerB,EAAQsB,QACvBA,EAAU1B,EAAc2B,UACxBA,EAAY1B,EAAgB2B,SAC5BA,EAAW,OAAMC,OACjBA,EAAS,cAAaC,IACtBA,GAAM,IAEN,MAAMC,EAAepF,EAAWzB,GAC1B8G,EAAaF,GAAOnF,EAAWpB,GACrCF,EAAQ0G,GAAgBA,EAAa1G,OAASA,EAC9CC,EAASyG,GAAgBA,EAAazG,QAAUA,GAAUsE,EAAaC,WAAWC,SAElF,MAAMmC,EAAmBC,GAAQ,IAAMV,EAAclG,EAAO6E,IAAIA,KAAO,CAAC7E,EAAQkG,EAAerB,IACzFgC,EAAWD,GAAQ,IAAMP,EAAU,MAAOM,EAAiBG,OAAO,CAACH,IACrE5G,EAAMqG,KACRrG,EAAMqG,GAAW,CAAE,GAErB,MAAMW,EAAiBhH,EAAMqG,GAASS,GAEhCG,EAAyB,iBAAXT,GAEZU,EAAOC,GAAa3D,EAAS,OAC7B4D,EAASC,GAAe7D,GAC7ByD,IACID,IAECM,EAAaC,GAAmB/D,EAAS,MAC3CgE,EACAP,EACED,GACE/B,EAAqBC,KAAK8B,EAAgBhH,GAC5CsH,EAEFG,EAAYC,GAAO,GACzBjE,GAAU,IAAM,IAAMgE,EAAUE,SAAU,GAAO,IACjD,MAAMC,EAAkBF,EAAO,IAE/B,SAASG,EAAQC,GACXA,GAAYL,EAAUE,UACxBN,GAAW,GACXF,EAAS,MACTI,EAAe,OAEjB,MAAMQ,EAAUnB,EACbnE,MAEA8D,IAAUyB,GAAQ5B,EAAa4B,KAC/BC,MAAKC,IACJ,MAAMtC,EAAiBrB,EAAaC,WAAWE,SAASwD,EAAQjC,GAChEjG,EAAMqG,GAASS,GAAYzB,OAAOC,QAAQM,GAAgBuC,QAAO,CAAChD,GAAYK,EAAQ4C,MACpFjD,EAASK,GAAUH,OAAOgD,KAAKD,GACxBjD,IACN,IACHF,EAAqBU,MAAMC,EAAgB5F,GAC3C,MAAMsI,EAAarD,EAAqBC,KAAKlF,EAAMqG,GAASS,GAAW9G,GAMvE,OALA4H,EAAgBD,QAAQY,OAAOX,EAAgBD,QAAQa,QAAQT,GAAU,GACrEpB,GAAec,EAAUE,SAA8C,IAAnCC,EAAgBD,QAAQ5G,SAC9DwG,EAAee,GACfjB,GAAW,IAENiB,KAERG,OAAMvB,IAML,GALAU,EAAgBD,QAAQY,OAAOX,EAAgBD,QAAQa,QAAQT,GAAU,GACrEpB,GAAec,EAAUE,SAA8C,IAAnCC,EAAgBD,QAAQ5G,SAC9DoG,EAASD,GACTG,GAAW,IAEVV,EACD,MAAMO,KAOZ,OAJAU,EAAgBD,QAAQe,KAAKX,GAC1BpB,GACDA,EAAW+B,KAAKX,GAEXA,CACR,CAED,SAASY,EAAgBb,GAAU,GAE9B5B,KACMgB,GACW,gBAAXV,GAA6BgB,GAEpCK,EAAQC,EAEX,CAUD,OARArE,GAAU,WACRkF,GACJ,GAAK,CAAE7B,EAAUZ,MAEZS,GACDgC,GAAgB,GAGXzC,IAAS,CACdsB,KAAM,KACNN,MAAO,KACPE,SAAS,EACTS,WACE,CACFT,UACAI,OACAN,QACAW,UAEJ,CCnHO,SAASe,EAAW9D,GAAK9E,MAC9BA,EAAKC,OACLA,EAAMiG,KACNA,EAAO,MAAM,GAAKC,cAClBA,EAAgBpB,EAAQqB,aACxBA,EAAerB,EAAQsB,QACvBA,EAAU1B,EAAc2B,UACxBA,EAAY1B,EAAgB2B,SAC5BA,EAAW,OAAMC,OACjBA,EAAS,cAAaC,IACtBA,GAAM,IAEN,MAAMC,EAAepF,EAAWzB,GAC1B8G,EAAaF,GAAOnF,EAAWpB,GACrCF,EAAQ0G,GAAgBA,EAAa1G,OAASA,EAC9CC,EAASyG,GAAgBA,EAAazG,QAAUA,GAAUsE,EAAaC,WAAWC,SAElF,MAAMmC,EAAmBC,GAAQ,IAAMV,EAAclG,EAAO6E,IAAIA,KAAO,CAAC7E,EAAQkG,EAAerB,IACzFgC,EAAWD,GAAQ,IAAMP,EAAU,MAAOM,EAAiBG,OAAO,CAACH,IACrE5G,EAAMqG,KACRrG,EAAMqG,GAAW,CAAE,GAErB,MAAMwC,EAAa7I,EAAMqG,GAASS,GAE5BG,EAAyB,iBAAXT,GAEZU,EAAOC,GAAa3D,EAAS,OAC7B4D,EAASC,GAAe7D,GAC7ByD,IACI4B,IAECvB,EAAaC,GAAmB/D,EAAS,MAC3CgE,EAAOP,EAAc4B,EAAavB,EAElCG,EAAYC,GAAO,GACzBjE,GAAU,IAAM,IAAMgE,EAAUE,SAAU,GAAO,IACjD,MAAMC,EAAkBF,EAAO,IAE/B,SAASG,EAAQC,GACXA,GAAYL,EAAUE,UACxBN,GAAW,GACXF,EAAS,MACTI,EAAe,OAEjB,MAAMQ,EAAUnB,EACbnE,MAEA8D,IAAUyB,GAAQ5B,EAAa4B,KAC/BC,MAAKC,IACJlI,EAAMqG,GAASS,GAAYoB,EAC3BN,EAAgBD,QAAQY,OAAOX,EAAgBD,QAAQa,QAAQT,GAAU,GACrEpB,GAAec,EAAUE,SAA8C,IAAnCC,EAAgBD,QAAQ5G,SAC9DwG,EAAeW,GACfb,GAAW,IAENa,KAERO,OAAMvB,IAML,GALAU,EAAgBD,QAAQY,OAAOX,EAAgBD,QAAQa,QAAQT,GAAU,GACrEpB,GAAec,EAAUE,SAA8C,IAAnCC,EAAgBD,QAAQ5G,SAC9DoG,EAASD,GACTG,GAAW,IAEVV,EACD,MAAMO,KAOZ,OAJAU,EAAgBD,QAAQe,KAAKX,GAC1BpB,GACDA,EAAW+B,KAAKX,GAEXA,CACR,CAED,SAASY,EAAgBb,GAAU,GAE9B5B,KACMgB,GACW,gBAAXV,GAA6BgB,GAEpCK,EAAQC,EAEX,CAUD,OARArE,GAAU,WACRkF,GACJ,GAAK,CAAE7B,EAAUZ,MAEZS,GACDgC,GAAgB,GAGXzC,IAAS,CACdsB,KAAM,KACNN,MAAO,KACPE,SAAS,EACTS,WACE,CACFT,UACAI,OACAN,QACAW,UAEJ,CCxGA,SAASiB,EAAWtB,EAAMhC,EAAQuD,GAChC,OACEvB,EACS,OAAPuB,EACEvB,EAAKhC,IAAWgC,EAAKhC,GAAQuD,GAC7BvB,EAAKhC,IAAWH,OAAO2D,OAAOxB,EAAKhC,IACrCgC,CAEN,CAEO,SAASyB,EAAYzD,EAAQV,GAAKiE,GACvCA,EAAK,KAAI/I,MACTA,EAAKiG,UACLA,EAAShG,OACTA,EACAiG,KAAMgD,EAAW,MAAM,GAAK/C,cAC5BA,EAAaC,aACbA,EAAYE,UACZA,EAASD,QACTA,EAAOE,SACPA,EAAQC,OACRA,EAAS,cAAaC,IACtBA,GAAM,IAEN,MAAMC,EAAepF,EAAWzB,GAChCG,EAAQ0G,GAAgBA,EAAa1G,OAASA,EAC9C,MAAMmJ,EAAeJ,GAAM/I,EAAMwF,IAAWxF,EAAMwF,GAAQuD,IAEpDvB,KACJA,EAAIJ,QACJA,EAAOF,MACPA,EACAW,QAASuB,GACPpD,EAAqBlB,EAAK,CAC5B9E,QACAiG,UAAW,CACToD,OAAQ,MACLpD,EACHT,UAEFvF,SACAiG,KAAI,IAEW,gBAAXM,GAA4B2C,GACpBD,IAGZ/C,gBACAC,eACAE,YACAD,UACAE,WACAC,SACAC,QAGI6C,EAAgBzC,GAAQ,IAC5BiC,EAAWtB,EAAMhC,EAAQuD,IACzB,CAACvB,EAAMhC,EAAQuD,IAEXlB,EAAU,IAAMuB,IAAoBnB,MAAKT,GAC7CsB,EAAWtB,EAAMhC,EAAQuD,KAG3B,MAAc,iBAAXvC,GAA6B2C,EACvB,CACL3B,KAAM2B,EACN/B,SAAS,EACTF,MAAO,KACPW,WAIG,CACLL,KAAM8B,EACNlC,UACAF,QACAW,UAEJ,CCjFO,SAAS0B,GAAqB9E,OAAEA,EAAMC,SAAEA,IAC1CD,IAAQF,EAAaC,WAAWC,OAASA,GACzCC,IAAUH,EAAaC,WAAWE,SAAWA,EAClD,CCEY,MAAC1E,EAAQ,SAASwJ,EAAKC,EAAU,IAC3C,OAAO/H,EAAWgI,QAAQF,EAAKnE,OAAOsE,OAAO,CAAEC,MAAM,EAAMC,OAAO,GAASJ,GAC7E"}