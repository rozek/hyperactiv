!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("wretch"),require("normaliz")):"function"==typeof define&&define.amd?define(["exports","wretch","normaliz"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["hyperactiv-http"]={},e.wretch,e.normaliz)}(this,(function(e,t,r){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=n(t);const c="__requests__",u=(e,t)=>`${e}@${t}`,i=e=>e,l={read(e,t){const r={};return Object.entries(e).forEach((([e,n])=>{r[e]={},n.forEach((n=>{r[e][n]=t[e]&&t[e][n]||null}))})),r},write(e,t){Object.entries(e).forEach((([e,r])=>{t[e]||(t[e]={}),Object.entries(r).forEach((([r,n])=>{t[e][r]&&"object"==typeof t[e][r]&&"object"==typeof n?Object.entries(n).forEach((([n,o])=>{t[e][r][n]=o})):t[e][r]=n}))}))}};function s(e,{store:t,normalize:n,client:s=o.default(),beforeRequest:f=i,afterRequest:a=i,rootKey:y=c,serialize:d=u,bodyType:h="json",policy:b="cache-first"}){const p=f(s.url(e)),j=d("get",p._url);t[y]||(t[y]={});const q=t[y][j],z="network-only"!==b&&q&&l.read(q,t)||null;function m(){return p.get()[h]((e=>a(e))).then((e=>{const o=r.normaliz(e,n);t[y][j]=Object.entries(o).reduce(((e,[t,r])=>(e[t]=Object.keys(r),e)),{}),l.write(o,t);return l.read(t[y][j],t)}))}const w="cache-first"===b&&z?null:m();return{data:z,refetch:m,future:w}}function f(e,t,r){return e?null!==r?e[t]&&e[t][r]:e[t]&&Object.values(e[t]):e}e.normalized=s,e.request=function(e,{store:t,client:r=o.default(),beforeRequest:n=i,afterRequest:l=i,rootKey:s=c,serialize:f=u,bodyType:a="json",policy:y="cache-first"}){const d=n(r.url(e)),h=f("get",d._url);t[s]||(t[s]={});const b=t[s][h],p="network-only"!==y&&b||null;function j(){return d.get()[a]((e=>l(e))).then((e=>(t[s][h]=e,e)))}const q="cache-first"===y&&p?null:j();return{data:p,refetch:j,future:q}},e.resource=function(e,t,{id:r=null,store:n,normalize:o,client:c,beforeRequest:u,afterRequest:i,serialize:l,rootKey:a,bodyType:y,policy:d="cache-first"}){const h=r&&n[e]&&n[e][r],{data:b,future:p,refetch:j}=s(t,{store:n,normalize:{schema:[],...o,entity:e},client:c,beforeRequest:u,afterRequest:i,serialize:l,rootKey:a,bodyType:y,policy:d});return{data:"network-only"!==d&&h||f(b,e,r),future:p&&p.then((t=>f(t,e,r)))||null,refetch:()=>j().then((t=>f(t,e,r)))}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.js.map
